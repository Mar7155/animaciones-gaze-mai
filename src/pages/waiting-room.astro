---
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <div id="lobby-wrapper">
    <div id="lobby-ui" class="neon-container">
      <h1 class="neon-text">TRON SYSTEM</h1>
      <p class="status-text">ESPERANDO CONEXIÓN...</p>
      
      <div class="input-group">
        <input type="text" id="username" placeholder="IDENTIFICADOR_USUARIO" />
      </div>

      <div class="actions">
        <button id="btn-create" class="btn-neon blue">CREAR NUEVA SALA</button>
        
        <div class="separator">
          <span>O</span>
        </div>

        <div class="input-group">
          <input type="text" id="room-code" placeholder="CÓDIGO_SALA" maxlength="4" />
          <button id="btn-join" class="btn-neon orange">UNIRSE A GRID</button>
        </div>
      </div>
    </div>
  </div>

  <style>
    #lobby-wrapper {
      background: #050505;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: 'Monoid', monospace;
      color: #7dfdfe;
    }

    .neon-container {
      border: 2px solid #00ffff;
      padding: 3rem;
      background: rgba(0, 255, 255, 0.05);
      box-shadow: 0 0 20px #00ffff55, inset 0 0 10px #00ffff33;
      text-align: center;
      width: 400px;
    }

    .neon-text {
      font-size: 2.5rem;
      text-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff;
      margin-bottom: 0.5rem;
    }

    .status-text {
      font-size: 0.8rem;
      letter-spacing: 3px;
      margin-bottom: 2rem;
      color: #ff6600;
    }

    .input-group {
      margin-bottom: 1.5rem;
    }

    input {
      background: transparent;
      border: 1px solid #7dfdfe;
      padding: 0.8rem;
      color: #fff;
      width: 100%;
      text-align: center;
      margin-bottom: 0.5rem;
      outline: none;
    }

    input:focus { border-color: #ff6600; box-shadow: 0 0 10px #ff660055; }

    .btn-neon {
      cursor: pointer;
      background: transparent;
      padding: 1rem 2rem;
      border: 2px solid;
      font-weight: bold;
      transition: 0.3s;
      width: 100%;
    }

    .blue { border-color: #00ffff; color: #00ffff; }
    .blue:hover { background: #00ffff; color: #000; box-shadow: 0 0 30px #00ffff; }

    .orange { border-color: #ff6600; color: #ff6600; }
    .orange:hover { background: #ff6600; color: #000; box-shadow: 0 0 30px #ff6600; }

    .separator { margin: 1rem 0; font-size: 0.7rem; opacity: 0.5; }
  </style>

  <div id="game-container" style="display: none;">
     </div>
</Layout>

<script is:inline type="module">
  import { client } from "../../src/lib/convex-client.ts";
  import { api } from "../../convex/_generated/api";

  const btnCreate = document.querySelector('#btn-create');
  const btnJoin = document.querySelector('#btn-join');
  const lobbyUI = document.querySelector('#lobby-wrapper');
  const gameContainer = document.querySelector('#game-container');

  // CREAR SALA
  btnCreate.addEventListener('click', async () => {
    const name = document.querySelector('#username').value || "ANON_USER";
    try {
      const { roomId, code, playerId } = await client.mutation(api.rooms.create, { name });
      console.log(`Grid Creado. Código de acceso: ${code}`);
      
      // Redirigir a la página de juego
      window.location.href = `/Tron-game?room=${roomId}&player=${playerId}`;
    } catch (e) {
      console.error("Error al inicializar Grid:", e);
    }
  });

  // UNIRSE A SALA
  btnJoin.addEventListener('click', async () => {
    const name = document.querySelector('#username').value || "GUEST_USER";
    const code = document.querySelector('#room-code').value.toUpperCase();
    
    try {
      const { roomId, playerId } = await client.mutation(api.rooms.join, { code, name });
      
      // Redirigir a la página de juego
      window.location.href = `/Tron-game?room=${roomId}&player=${playerId}`;
    } catch (e) {
      console.error(e);
      alert("CÓDIGO DE RED NO VÁLIDO O SALA LLENA");
    }
  });
</script>